# æ•°æ®åº“æ–‡ä»¶å¤„ç†è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†NL2DBé¡¹ç›®ä¸­æ•°æ®åº“æ–‡ä»¶çš„å¤„ç†æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯å½“`database.db`ä¸å­˜åœ¨æ—¶ç³»ç»Ÿçš„è¡Œä¸ºï¼Œä»¥åŠå¦‚ä½•å®‰å…¨åœ°å°†é¡¹ç›®ä¸Šä¼ åˆ°GitHubã€‚

## ğŸ—„ï¸ æ•°æ®åº“æ–‡ä»¶è¯´æ˜

### ä¸»è¦æ–‡ä»¶

| æ–‡ä»¶å | ç”¨é€” | æ˜¯å¦ä¸Šä¼ Git | è¯´æ˜ |
|--------|------|-------------|------|
| `database.db` | ç»Ÿä¸€æ•°æ®åº“æ–‡ä»¶ | âŒ å¦ | åŒ…å«å¤„ç†åçš„Excelæ•°æ® |
| `file_registry.json` | æ–‡ä»¶æ³¨å†Œè¡¨ | âŒ å¦ | è®°å½•æ–‡ä»¶å“ˆå¸Œå’ŒçŠ¶æ€ä¿¡æ¯ |
| `uploads/*.xlsx` | ç”¨æˆ·Excelæ–‡ä»¶ | âŒ å¦ | ç”¨æˆ·çš„åŸå§‹æ•°æ®æ–‡ä»¶ |
| `.env` | ç¯å¢ƒå˜é‡é…ç½® | âŒ å¦ | åŒ…å«APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ |

### è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶

ä»¥ä¸‹æ–‡ä»¶ä¼šåœ¨ç³»ç»Ÿè¿è¡Œæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œ**ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»º**ï¼š

- `database.db` - ç»Ÿä¸€æ•°æ®åº“æ–‡ä»¶
- `file_registry.json` - æ–‡ä»¶çŠ¶æ€æ³¨å†Œè¡¨
- `cache/` ç›®å½•ä¸‹çš„ç¼“å­˜æ–‡ä»¶
- `Faiss/` ç›®å½•ä¸‹çš„å‘é‡ç´¢å¼•æ–‡ä»¶

## ğŸš€ é¦–æ¬¡è¿è¡Œæµç¨‹

### å½“`database.db`ä¸å­˜åœ¨æ—¶

ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹æ­¥éª¤è‡ªåŠ¨å¤„ç†ï¼š

1. **æ•°æ®åº“åˆå§‹åŒ–**
   ```python
   # DatabaseManager.__init__() ä¼šè°ƒç”¨
   self._init_database()
   ```
   - åˆ›å»ºæ–°çš„SQLiteæ•°æ®åº“æ–‡ä»¶
   - åˆ›å»ºå¿…è¦çš„å…ƒæ•°æ®è¡¨ï¼ˆ`file_versions`, `table_mappings`ï¼‰

2. **ç›®å½•æ‰«æ**
   ```python
   # æ‰«æuploadsç›®å½•
   db_manager.check_all_files("uploads")
   ```
   - è‡ªåŠ¨å‘ç°æ‰€æœ‰`.xlsx`å’Œ`.xls`æ–‡ä»¶
   - è®¡ç®—æ¯ä¸ªæ–‡ä»¶çš„MD5å“ˆå¸Œå€¼

3. **æ•°æ®å¯¼å…¥**
   - é€ä¸ªå¤„ç†Excelæ–‡ä»¶çš„æ¯ä¸ªå·¥ä½œè¡¨
   - åº”ç”¨æ™ºèƒ½åˆ—åæ˜ å°„å’Œæ¸…ç†
   - å°†æ•°æ®å¯¼å…¥åˆ°å¯¹åº”çš„æ•°æ®åº“è¡¨ä¸­
   - è®°å½•æ–‡ä»¶çŠ¶æ€åˆ°æ³¨å†Œè¡¨

4. **ç´¢å¼•å»ºç«‹**
   - åˆ›å»ºå¿…è¦çš„æ•°æ®åº“ç´¢å¼•
   - ç”Ÿæˆå‘é‡ç´¢å¼•ï¼ˆå¦‚æœå¯ç”¨ï¼‰

### ç¤ºä¾‹è¾“å‡º

```
ğŸ—„ï¸ åˆå§‹åŒ–æ•°æ®åº“...
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“Š å‘ç° 3 ä¸ªExcelæ–‡ä»¶ï¼Œå¼€å§‹å¤„ç†...
ğŸ“„ å¤„ç†æ–‡ä»¶: ä»·æ ¼è¡¨.xlsx
  ğŸ“‹ å·¥ä½œè¡¨: äº§å“ä»·æ ¼ -> table_ä»·æ ¼è¡¨_äº§å“ä»·æ ¼
  ğŸ“‹ å·¥ä½œè¡¨: æœåŠ¡ä»·æ ¼ -> table_ä»·æ ¼è¡¨_æœåŠ¡ä»·æ ¼
ğŸ“„ å¤„ç†æ–‡ä»¶: åº“å­˜è¡¨.xlsx
  ğŸ“‹ å·¥ä½œè¡¨: å½“å‰åº“å­˜ -> table_åº“å­˜è¡¨_å½“å‰åº“å­˜
âœ… Excelæ–‡ä»¶å¤„ç†å®Œæˆ
```

## ğŸ”„ å¢é‡æ›´æ–°æœºåˆ¶

### æ–‡ä»¶å˜åŒ–æ£€æµ‹

ç³»ç»Ÿä½¿ç”¨MD5å“ˆå¸Œæ¥æ£€æµ‹æ–‡ä»¶å˜åŒ–ï¼š

```python
def get_file_hash(self, file_path: str) -> str:
    """è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼"""
    hash_md5 = hashlib.md5()
    with open(file_path, "rb") as f:
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()
```

### æ›´æ–°ç­–ç•¥

- **æ–‡ä»¶æœªå˜åŒ–**: è·³è¿‡å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜
- **æ–‡ä»¶å·²å˜åŒ–**: é‡æ–°å¤„ç†å¹¶æ›´æ–°æ•°æ®åº“
- **æ–°å¢æ–‡ä»¶**: è‡ªåŠ¨æ£€æµ‹å¹¶å¯¼å…¥
- **åˆ é™¤æ–‡ä»¶**: æ¸…ç†ç›¸å…³çš„æ•°æ®åº“è¡¨

## ğŸ”’ GitHubä¸Šä¼ å‡†å¤‡

### 1. æ£€æŸ¥.gitignoreæ–‡ä»¶

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å·²è¢«å¿½ç•¥ï¼š

```gitignore
# æ•°æ®åº“æ–‡ä»¶
database.db
file_registry.json

# ç”¨æˆ·æ•°æ®
uploads/*.xlsx
uploads/*.xls

# ç¯å¢ƒé…ç½®
.env

# ç¼“å­˜æ–‡ä»¶
cache/
__pycache__/
Faiss/
```

### 2. æ¸…ç†æ•æ„Ÿæ•°æ®

è¿è¡Œæ¸…ç†è„šæœ¬ï¼š

```bash
python cleanup_old_cache.py
```

### 3. éªŒè¯æ–‡ä»¶çŠ¶æ€

æ£€æŸ¥å“ªäº›æ–‡ä»¶ä¼šè¢«ä¸Šä¼ ï¼š

```bash
git status
git add .
git status  # å†æ¬¡æ£€æŸ¥
```

### 4. å®‰å…¨æ£€æŸ¥æ¸…å•

- [ ] `database.db` ä¸åœ¨Gitè·Ÿè¸ªä¸­
- [ ] `file_registry.json` ä¸åœ¨Gitè·Ÿè¸ªä¸­
- [ ] `.env` æ–‡ä»¶ä¸åœ¨Gitè·Ÿè¸ªä¸­
- [ ] `uploads/` ä¸­çš„Excelæ–‡ä»¶ä¸åœ¨Gitè·Ÿè¸ªä¸­
- [ ] å·²åˆ›å»º `.env.example` ä½œä¸ºé…ç½®æ¨¡æ¿
- [ ] README.md åŒ…å«å®Œæ•´çš„è®¾ç½®è¯´æ˜

## ğŸ› ï¸ æ•…éšœæ’é™¤

### æ•°æ®åº“æŸå

å¦‚æœæ•°æ®åº“æ–‡ä»¶æŸåï¼š

```bash
# åˆ é™¤æŸåçš„æ•°æ®åº“
rm database.db file_registry.json

# é‡æ–°åˆå§‹åŒ–
python init_system.py
```

### æ–‡ä»¶æ³¨å†Œè¡¨ä¸ä¸€è‡´

å¦‚æœæ–‡ä»¶æ³¨å†Œè¡¨ä¸å®é™…æ–‡ä»¶ä¸ä¸€è‡´ï¼š

```bash
# åˆ é™¤æ³¨å†Œè¡¨ï¼Œå¼ºåˆ¶é‡æ–°æ‰«æ
rm file_registry.json

# é‡æ–°è¿è¡Œç³»ç»Ÿ
python NL2DB.py
```

### æƒé™é—®é¢˜

ç¡®ä¿ç¨‹åºæœ‰æƒé™è¯»å†™ä»¥ä¸‹ç›®å½•ï¼š

- å½“å‰å·¥ä½œç›®å½•ï¼ˆç”¨äºåˆ›å»ºdatabase.dbï¼‰
- `uploads/` ç›®å½•
- `cache/` ç›®å½•

## ğŸ“ æœ€ä½³å®è·µ

### å¼€å‘ç¯å¢ƒ

1. **æœ¬åœ°å¼€å‘**
   - ä½¿ç”¨çœŸå®çš„Excelæ–‡ä»¶è¿›è¡Œæµ‹è¯•
   - å®šæœŸå¤‡ä»½é‡è¦çš„æ•°æ®åº“æ–‡ä»¶
   - ä½¿ç”¨ä¸åŒçš„APIå¯†é’¥è¿›è¡Œå¼€å‘å’Œç”Ÿäº§

2. **ç‰ˆæœ¬æ§åˆ¶**
   - åªæäº¤ä»£ç å’Œé…ç½®æ¨¡æ¿
   - ä½¿ç”¨åˆ†æ”¯è¿›è¡ŒåŠŸèƒ½å¼€å‘
   - åœ¨READMEä¸­è¯¦ç»†è¯´æ˜è®¾ç½®æ­¥éª¤

### ç”Ÿäº§éƒ¨ç½²

1. **ç¯å¢ƒéš”ç¦»**
   - ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“æ–‡ä»¶
   - é…ç½®ä¸“ç”¨çš„APIå¯†é’¥
   - è®¾ç½®é€‚å½“çš„æ–‡ä»¶æƒé™

2. **æ•°æ®å¤‡ä»½**
   - å®šæœŸå¤‡ä»½database.db
   - å¤‡ä»½file_registry.json
   - ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [README.md](README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜
# - [enhanced_column_mapping_usage.md](enhanced_column_mapping_usage.md) - åˆ—åæ˜ å°„è¯´æ˜ï¼ˆå·²åˆ é™¤ï¼‰
- [NL2DBæµç¨‹.md](NL2DBæµç¨‹.md) - ç³»ç»Ÿæµç¨‹è¯´æ˜