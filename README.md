# ğŸš€ NL2DB - ä¸€ç§é«˜ç²¾å‡†åº¦çš„è‡ªç„¶è¯­è¨€EXCELæ–‡æ¡£æ•°æ®æŸ¥è¯¢MCPæœåŠ¡

<div align="center">

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![LangChain](https://img.shields.io/badge/LangChain-Latest-green.svg)](https://langchain.com/)
[![FastMCP](https://img.shields.io/badge/FastMCP-2.8.1-orange.svg)](https://github.com/jlowin/fastmcp)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![GitHub Stars](https://img.shields.io/github/stars/your-username/NL2DB?style=social)](https://github.com/your-username/NL2DB)

**ğŸŒŸ åŸºäºå¤§æ¨¡å‹çš„ä¸‹ä¸€ä»£æ™ºèƒ½æ•°æ®æŸ¥è¯¢å¼•æ“ ğŸŒŸ**

*å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºç²¾ç¡®çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œè®©Excelæ•°æ®æŸ¥è¯¢å˜å¾—åƒèŠå¤©ä¸€æ ·ç®€å•*

[ğŸ¯ å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [âœ¨ æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§) â€¢ [ğŸ—ï¸ ç³»ç»Ÿæ¶æ„](#ï¸-ç³»ç»Ÿæ¶æ„) â€¢ [ğŸ“– ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—) â€¢ [ğŸ”§ APIæ–‡æ¡£](#-apiæ–‡æ¡£)

</div>

---

## ğŸ¯ é¡¹ç›®æ¦‚è¦

**NL2DB** æ˜¯ä¸€ç§é«˜ç²¾å‡†åº¦çš„è‡ªç„¶è¯­è¨€EXCELæ–‡æ¡£æ•°æ®æŸ¥è¯¢MCPæœåŠ¡ï¼Œå®ƒæ‰“ç ´äº†ä¼ ç»Ÿæ•°æ®åˆ†æçš„æŠ€æœ¯å£å’ã€‚é€šè¿‡å…ˆè¿›çš„å¤§è¯­è¨€æ¨¡å‹å’Œå‘é‡æ£€ç´¢æŠ€æœ¯ï¼Œè®©ä»»ä½•äººéƒ½èƒ½ç”¨è‡ªç„¶è¯­è¨€è½»æ¾æŸ¥è¯¢å¤æ‚çš„Excelæ•°æ®ï¼Œæ— éœ€å­¦ä¹ SQLæˆ–å¤æ‚çš„æ•°æ®åˆ†æå·¥å…·ã€‚
ä½¿ç”¨è¿‡å‘é‡æ£€ç´¢çš„éƒ½çŸ¥é“ï¼Œå¯¹äºå¤æ‚çš„Excelæ–‡æ¡£ï¼Œç»Excelè§£æå†chunkåï¼Œéš¾ä»¥å°†çœŸæ­£çš„è¡¨å¤´ä¿¡æ¯ä¸æ•°æ®ç›¸å…³è”ï¼Œå¯¼è‡´æ£€ç´¢æˆåŠŸç‡ä½ã€‚
æœ¬é¡¹ç›®å°†å¤æ‚çš„excelæ–‡æ¡£å‘é‡æ£€ç´¢æˆ–å…³é”®è¯æ£€ç´¢è½¬åŒ–æˆä½¿ç”¨SQLè¯­å¥çš„ç²¾å‡†æ•°æ®åº“æ£€ç´¢ï¼Œå¤§å¤§æé«˜äº†æ£€ç´¢æˆåŠŸç‡ã€‚
<font color="red">[ğŸ“‹ äº†è§£ç³»ç»Ÿæµç¨‹ç‚¹è¿™é‡Œ](./NL2DBæµç¨‹.md)</font>
å¦å¤–ï¼Œæœ¬ä»£ç ä¿ç•™äº†æ‰€æœ‰è°ƒè¯•è¾“å‡ºè¯­å¥ï¼Œå¯ä»¥æ–¹ä¾¿æŸ¥çœ‹æ¯ä¸€ä¸ªæ­¥éª¤çš„è¾“å‡ºæƒ…å†µã€‚

### ğŸ“¸ æ•ˆæœå±•ç¤º

#### ğŸ” æ£€ç´¢æ•ˆæœå¯¹æ¯”

##### ğŸš« ä¼ ç»Ÿå‘é‡æ£€ç´¢

<div align="center">

![ä¼ ç»Ÿå‘é‡æ£€ç´¢](images/æœªå¼€å¯MCP(æ™®é€šå‘é‡æ£€ç´¢).png)

*æ— æ³•æ£€ç´¢åˆ°ç›¸å…³æ•°æ®ï¼Œéš¾ä»¥ç†è§£è¡¨æ ¼ç»“æ„*

</div>

##### âœ… NL2DBæ™ºèƒ½æ£€ç´¢

<div align="center">

![NL2DBæ™ºèƒ½æ£€ç´¢](images/å¼€å¯MCP_1.png)

*NL2DBèƒ½å¤Ÿç²¾å‡†ç†è§£è¡¨å¤´ï¼Œå‡†ç¡®è¿”å›æ•°æ®*

</div>

##### ğŸ¯ æºæ–‡æ¡£æ­£ç¡®ç­”æ¡ˆ

<div align="center">

![æŸ¥è¯¢ç»“æœç¤ºä¾‹](images/8-3æ­£ç¡®ç­”æ¡ˆ.png)

*NL2DBèƒ½å¤Ÿå‡†ç¡®ç†è§£ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢ï¼Œå¹¶è¿”å›ç²¾ç¡®çš„ç»“æœ*

</div>



### ğŸŒˆ ä¸ºä»€ä¹ˆé€‰æ‹© NL2DBï¼Ÿ

- ğŸ§  **AIé©±åŠ¨**: åŸºäºæœ€æ–°çš„å¤§è¯­è¨€æ¨¡å‹ï¼Œç†è§£å¤æ‚çš„ä¸šåŠ¡æŸ¥è¯¢
- âš¡ **æé€Ÿå“åº”**: å¤šå±‚ç¼“å­˜æœºåˆ¶ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå‡95%
- ğŸ”„ **æ™ºèƒ½æ˜ å°„**: è‡ªåŠ¨è¯†åˆ«Excelè¡¨å¤´ï¼Œå»ºç«‹è¯­ä¹‰æ˜ å°„å…³ç³»
- ğŸŒ **MCPå…¼å®¹**: å®Œç¾é›†æˆModel Context Protocolç”Ÿæ€
- ğŸ›¡ï¸ **ä¼ä¸šçº§**: æ”¯æŒå¤šç§å¤§æ¨¡å‹ï¼Œä¿éšœæ•°æ®å®‰å…¨
- ğŸ“Š **é›¶é—¨æ§›**: æ‹–æ‹½Excelå³ç”¨ï¼Œæ— éœ€æŠ€æœ¯èƒŒæ™¯

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¨ æ™ºèƒ½åŒ–ç‰¹æ€§

| ç‰¹æ€§ | æè¿° | æŠ€æœ¯äº®ç‚¹ |
|------|------|----------|
| ğŸ§  **æ™ºèƒ½è¡¨å¤´è¯†åˆ«** | è‡ªåŠ¨è¯†åˆ«Excelå¤æ‚è¡¨å¤´ç»“æ„ | åŸºäºLLMçš„è¯­ä¹‰ç†è§£ |
| ğŸ” **è¯­ä¹‰æ£€ç´¢** | å‘é‡åŒ–æŸ¥è¯¢ï¼Œç²¾å‡†åŒ¹é…ç›¸å…³æ•°æ® | FAISS + BGEé‡æ’åº |
| ğŸ—£ï¸ **è‡ªç„¶è¯­è¨€æŸ¥è¯¢** | æ”¯æŒå¤æ‚çš„ä¸­æ–‡ä¸šåŠ¡æŸ¥è¯¢ | å¤šæ¨¡å‹æ”¯æŒ(GLM/OpenAI/Qwen) |
| ğŸ”„ **æ™ºèƒ½SQLç”Ÿæˆ** | è‡ªåŠ¨ç”Ÿæˆä¼˜åŒ–çš„SQLæŸ¥è¯¢è¯­å¥ | åˆ—åæ˜ å°„ + ä¸Šä¸‹æ–‡æ„ŸçŸ¥ |
| ğŸ“Š **ç»“æ„åŒ–è¾“å‡º** | JSONæ ¼å¼çš„æ ‡å‡†åŒ–æŸ¥è¯¢ç»“æœ | MCPåè®®å…¼å®¹ |

### âš¡ æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å¹…åº¦ |
|--------|--------|--------|----------|
| ğŸš€ **å¯åŠ¨æ—¶é—´** | 32ç§’ | 8-12ç§’ | **62-75%** |
| âš¡ **é¦–æ¬¡æŸ¥è¯¢** | 35-45ç§’ | 12-18ç§’ | **65-75%** |
| ğŸ”„ **é‡å¤æŸ¥è¯¢** | 30-40ç§’ | 1-5ç§’ | **85-95%** |
| ğŸ’¾ **å†…å­˜ä½¿ç”¨** | åŸºå‡† | -30~50% | **æ˜¾è‘—ä¼˜åŒ–** |
| ğŸ”€ **å¹¶å‘å¤„ç†** | åŸºå‡† | +60~70% | **æ˜¾è‘—æå‡** |

### ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

- **ğŸ”§ æ‡’åŠ è½½æœºåˆ¶**: æ¨¡å‹æŒ‰éœ€åŠ è½½ï¼Œä¼˜åŒ–å¯åŠ¨æ€§èƒ½
- **ğŸ§  å•ä¾‹æ¨¡å¼**: ç¡®ä¿æ¨¡å‹å®ä¾‹å”¯ä¸€ï¼ŒèŠ‚çœå†…å­˜
- **ğŸ“¦ å¤šå±‚ç¼“å­˜**: æ–‡ä»¶ç¼“å­˜ + å†…å­˜LRUç¼“å­˜
- **ğŸ”„ å¢é‡æ›´æ–°**: åŸºäºMD5å“ˆå¸Œçš„æ™ºèƒ½æ–‡ä»¶å˜æ›´æ£€æµ‹
- **âš¡ å¼‚æ­¥å¹¶å‘**: å¤šè¡¨å¤´å¹¶å‘è¯†åˆ«ï¼Œæå‡å¤„ç†æ•ˆç‡
- **ğŸ›¡ï¸ é”™è¯¯æ¢å¤**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### ğŸ“‹ æ ¸å¿ƒå·¥ä½œæµ

```mermaid
æ¡†æ¶ï¼šLangGraphæ¡†æ¶
å¤§æ¨¡å‹ï¼šç”¨å¯é€‰é…ç½®çš„æ–¹å¼å¼•å…¥ï¼Œæ”¯æŒGLM/OpenAI/Qwenç­‰æ¨¡å‹ã€‚
ä¸­æ–‡å‘é‡åŒ–æ¨¡å‹ï¼šm3e-baseæ¨¡å‹
å‘é‡æ•°æ®åº“ï¼šfaiss
rerankæ¨¡å‹ï¼šmodels--BAAI--bge-reranker-v2-m3
graph TD
    A[ğŸ“ Excelæ–‡ä»¶] --> B[ğŸ”„ æ™ºèƒ½è§£æ]
    B --> C[ğŸ’¾ SQLiteè½¬æ¢]
    C --> D[ğŸ§  è¡¨å¤´è¯†åˆ«]
    D --> E[ğŸ” å‘é‡åŒ–ç´¢å¼•]
    E --> F[ğŸ“ ç”¨æˆ·æŸ¥è¯¢]
    F --> G[ğŸ¯ è¯­ä¹‰æ£€ç´¢]
    G --> H[ğŸ”„ é‡æ’åºä¼˜åŒ–]
    H --> I[ğŸ› ï¸ SQLç”Ÿæˆ]
    I --> J[âš¡ æŸ¥è¯¢æ‰§è¡Œ]
    J --> K[ğŸ“Š ç»“æœè¿”å›]
```

### ğŸ›ï¸ æŠ€æœ¯æ¶æ„

<div align="center">

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸŒ MCPæœåŠ¡å±‚                              â”‚
â”‚  FastMCP Server + Server-Sent Events (SSE)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ğŸ§  AIæ¨ç†å±‚                               â”‚
â”‚  LangGraphå·¥ä½œæµ + å¤šæ¨¡å‹æ”¯æŒ + æ™ºèƒ½è·¯ç”±                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ğŸ” æ£€ç´¢å¢å¼ºå±‚                             â”‚
â”‚  FAISSå‘é‡æ•°æ®åº“ + BGEé‡æ’åº + è¯­ä¹‰ç¼“å­˜                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ğŸ’¾ æ•°æ®å¤„ç†å±‚                             â”‚
â”‚  SQLiteå¼•æ“ + Pandaså¤„ç† + å¢é‡æ›´æ–°                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ğŸ“Š æ•°æ®æºå±‚                               â”‚
â”‚  Excelæ–‡ä»¶ + æ™ºèƒ½è¡¨å¤´è¯†åˆ« + åˆ—åæ˜ å°„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

</div>

### ğŸ”§ æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | åŠŸèƒ½ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| **ğŸ¯ ModelManager** | ç»Ÿä¸€æ¨¡å‹ç®¡ç†ï¼Œæ‡’åŠ è½½ä¼˜åŒ– | å•ä¾‹æ¨¡å¼ + å¤šLLMæ”¯æŒ |
| **ğŸ’¾ DatabaseManager** | æ™ºèƒ½æ•°æ®åº“ç®¡ç†ï¼Œå¢é‡æ›´æ–° | SQLite + MD5æ ¡éªŒ |
| **ğŸ” HeaderCacheManager** | è¡¨å¤´åˆ†æç¼“å­˜ï¼Œæ€§èƒ½ä¼˜åŒ– | åŒå±‚ç¼“å­˜ + LRUç®—æ³• |
| **ğŸ—ºï¸ ColumnMappingGenerator** | åˆ—åæ˜ å°„ç”Ÿæˆï¼Œè¯­ä¹‰ç†è§£ | LLMé©±åŠ¨ + è‡ªåŠ¨åŒ– |
| **âš¡ LangGraphå·¥ä½œæµ** | æ™ºèƒ½æŸ¥è¯¢æµç¨‹ï¼ŒçŠ¶æ€ç®¡ç† | å¼‚æ­¥å¤„ç† + é”™è¯¯æ¢å¤ |

æ‰€æœ‰æ•°æ®åº“æ–‡ä»¶ã€å‘é‡æ•°æ®åº“æ–‡ä»¶ã€åˆ—åæ˜ å°„é…ç½®æ–‡ä»¶éƒ½æ”¯æŒè‡ªåŠ¨åˆ›å»ºå’Œå¢é‡æ›´æ–°ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç¯å¢ƒè¦æ±‚

- ğŸ **Python**: 3.8+
- ğŸ’¾ **å†…å­˜**: å»ºè®®8GB+
- ğŸ”§ **ç³»ç»Ÿ**: Windows/Linux/macOS

### âš¡ ä¸€é”®å®‰è£…

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/Yudewei1112/NL2DB.git
cd NL2DB

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒ
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„APIå¯†é’¥
```

### ğŸ”‘ ç¯å¢ƒé…ç½®

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
# ğŸ¤– å¤§æ¨¡å‹é…ç½® (é€‰æ‹©ä¸€ä¸ª)
LLM_PROVIDER=glm  # å¯é€‰: Glm, DeepSeek, Qwen, Claude, OpenAI
LLM_MODEL_NAME=glm-4-plus
LLM_TEMPERATURE=0.2

# ğŸ”‘ APIå¯†é’¥é…ç½®
# GLMé…ç½®
GLM_4_PLUS_API_KEY=your_glm_api_key
GLM_4_PLUS_API_BASE=https://open.bigmodel.cn/api/paas/v4/

# DeepSeek é…ç½®
DEEPSEEK_API_KEY=your_deepseek_api_key_here
DEEPSEEK_API_BASE=https://api.deepseek.com

# Qwené…ç½®ï¼ˆå¯é€‰ï¼‰
QWEN_API_KEY=your_qwen_api_key
QWEN_API_BASE=https://dashscope.aliyuncs.com/api/v1

# Claudeé…ç½®ï¼ˆå¯é€‰ï¼‰
CLAUDE_API_KEY=your_claude_api_key
CLAUDE_API_BASE=https://api.anthropic.com/v1

# OpenAIé…ç½®ï¼ˆå¯é€‰ï¼‰
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=https://api.openai.com/v1
```

### ğŸ¯ å¿«é€Ÿå¯åŠ¨

```bash
# ğŸš€ å¯åŠ¨MCPæœåŠ¡ï¼ˆé¦–æ¬¡å¯åŠ¨å¼ºçƒˆæ¨èï¼ï¼ï¼‰
python start_mcp_server.py
# ç³»ç»Ÿå°†è‡ªåŠ¨åˆ›å»ºFaissï¼Œcolumn_mapping_docsç­‰æ–‡ä»¶å¤¹
# æˆ–ç›´æ¥è¿è¡Œ
python NL2DB_mcp_server.py
```

### ğŸ“ æ·»åŠ æ•°æ®

å°†Excelæ–‡ä»¶æ”¾å…¥ `uploads/` ç›®å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ï¼š

```bash
uploads/
â”œâ”€â”€ é”€å”®æ•°æ®.xlsx
â”œâ”€â”€ åº“å­˜æ¸…å•.xlsx
â””â”€â”€ è´¢åŠ¡æŠ¥è¡¨.xlsx
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### ğŸŒ MCPæœåŠ¡æ¨¡å¼ï¼ˆæ¨èï¼‰

#### ğŸš€ å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆå¼ºçƒˆæ¨èï¼‰
python start_mcp_server.py

# æœåŠ¡ä¿¡æ¯
# ğŸŒ åœ°å€: http://127.0.0.1:9001
# ğŸ“¡ åè®®: Server-Sent Events (SSE)
# ğŸ”§ çŠ¶æ€: è‡ªåŠ¨å¥åº·æ£€æŸ¥
```

#### ğŸ§ª æµ‹è¯•æœåŠ¡

```bash
# è‡ªåŠ¨åŒ–æµ‹è¯•
python debug/test_mcp_client.py

# äº¤äº’å¼æµ‹è¯•
python debug/test_mcp_client.py --interactive
```

### ğŸ’» APIè°ƒç”¨ç¤ºä¾‹

#### Pythonå®¢æˆ·ç«¯

```python
import aiohttp
import asyncio
import json

async def query_data(query: str):
    async with aiohttp.ClientSession() as session:
        async with session.post(
            'http://127.0.0.1:9001/call/query_excel_data',
            json={'query': query}
        ) as response:
            result = await response.json()
            print(json.dumps(result, ensure_ascii=False, indent=2))

# ğŸ¯ ä½¿ç”¨ç¤ºä¾‹
asyncio.run(query_data("LEDç“¦ç‰‡ç¯çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ"))
```

#### cURLå‘½ä»¤

```bash
# ğŸ“Š æŸ¥è¯¢æ•°æ®
curl -X POST http://127.0.0.1:9001/call/query_excel_data \
  -H "Content-Type: application/json" \
  -d '{"query": "LEDç“¦ç‰‡ç¯çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ"}'

# â„¹ï¸ è·å–æœåŠ¡ä¿¡æ¯
curl http://127.0.0.1:9001/call/get_service_info

# ğŸ“ åˆ—å‡ºExcelæ–‡ä»¶
curl http://127.0.0.1:9001/call/list_excel_files
```

### ğŸ”§ ç›´æ¥è°ƒç”¨æ¨¡å¼

```python
import asyncio
from NL2DB import run_flow

async def main():
    query = "LEDç“¦ç‰‡ç¯çš„å®šä»·æ˜¯å¤šå°‘ï¼Ÿ"
    excel_file = "uploads/your_file.xlsx"
    db_file = "database.db"
    
    result = await run_flow(query, excel_file, db_file)
    print(result)

asyncio.run(main())
```

---

## ğŸ”§ APIæ–‡æ¡£

### ğŸ› ï¸ MCPå·¥å…·åˆ—è¡¨

#### 1. ğŸ“Š query_excel_data

**åŠŸèƒ½**: æŸ¥è¯¢Excelæ•°æ®çš„ä¸»è¦å·¥å…·

**å‚æ•°**:
- `query` (string): ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢

**è¿”å›ç¤ºä¾‹**:
```json
{

  "query": "LEDç“¦ç‰‡ç¯çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ",

  "answer": "LEDç“¦ç‰‡ç¯çš„å•ä»·æ˜¯150.00å…ƒï¼Œåº“å­˜æ•°é‡ä¸º100ä¸ªã€‚",

}
```

#### 2. ğŸ“ list_excel_files

**åŠŸèƒ½**: åˆ—å‡ºuploadsç›®å½•ä¸‹çš„Excelæ–‡ä»¶

**è¿”å›ç¤ºä¾‹**:
```json
{
  "status": "success",
  "files": ["é”€å”®æ•°æ®.xlsx", "åº“å­˜æ¸…å•.xlsx"],
  "count": 2,
  "directory": "uploads"
}
```

#### 3. ğŸ” check_vectorstore_status

**åŠŸèƒ½**: æ£€æŸ¥å‘é‡æ•°æ®åº“çŠ¶æ€

**è¿”å›ç¤ºä¾‹**:
```json
{
  "status": "success",
  "vectorstore_ready": true,
  "faiss_index_exists": true,
  "faiss_pkl_exists": true,
  "message": "å‘é‡æ•°æ®åº“å·²å°±ç»ª"
}
```

#### 4. â„¹ï¸ get_service_info

**åŠŸèƒ½**: è·å–æœåŠ¡åŸºæœ¬ä¿¡æ¯

**è¿”å›ç¤ºä¾‹**:
```json
{
  "service_name": "NL2DB Service",
  "version": "1.0.0",
  "description": "æ™ºèƒ½è‡ªç„¶è¯­è¨€æ•°æ®åº“æŸ¥è¯¢ç³»ç»Ÿ",
  "features": [
    "è‡ªç„¶è¯­è¨€æŸ¥è¯¢",
    "æ™ºèƒ½è¡¨å¤´è¯†åˆ«",
    "å‘é‡æ£€ç´¢",
    "SQLè‡ªåŠ¨ç”Ÿæˆ"
  ],
  "endpoints": {
    "query_excel_data": "æŸ¥è¯¢Excelæ•°æ®",
    "list_excel_files": "åˆ—å‡ºExcelæ–‡ä»¶",
    "check_vectorstore_status": "æ£€æŸ¥å‘é‡æ•°æ®åº“çŠ¶æ€",
    "get_service_info": "è·å–æœåŠ¡ä¿¡æ¯"
  },
  "status": "running"
}
```

---

## ğŸ“Š é¡¹ç›®ç»“æ„

```
NL2DB/
â”œâ”€â”€ ğŸš€ æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ NL2DB.py                      # ä¸»ç¨‹åºå…¥å£ï¼ŒLangGraphå·¥ä½œæµ
â”‚   â”œâ”€â”€ NL2DB_mcp_server.py           # MCPæœåŠ¡å™¨å®ç°
â”‚   â”œâ”€â”€ start_mcp_server.py           # æœåŠ¡å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ database_manager.py           # æ•°æ®åº“ç®¡ç†å™¨
â”‚   â””â”€â”€ column_mapping_generator.py   # åˆ—åæ˜ å°„ç”Ÿæˆå™¨
â”œâ”€â”€ ğŸ“ æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ uploads/                      # Excelæ–‡ä»¶å­˜æ”¾ç›®å½•
â”‚   â”œâ”€â”€ cache/                        # ç¼“å­˜ç›®å½•
â”‚   â”‚   â”œâ”€â”€ databases/                # æ•°æ®åº“ç¼“å­˜
â”‚   â”‚   â””â”€â”€ headers/                  # è¡¨å¤´ç¼“å­˜
â”‚   â”œâ”€â”€ Faiss/                        # FAISSå‘é‡ç´¢å¼•
â”‚   â””â”€â”€ column_mapping_docs/          # åˆ—åæ˜ å°„é…ç½®
â”œâ”€â”€ ğŸ”§ é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ .env                          # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”‚   â”œâ”€â”€ requirements.txt              # ä¾èµ–åŒ…åˆ—è¡¨
â”‚   â””â”€â”€ excel_header_prompt.txt       # è¡¨å¤´è¯†åˆ«æç¤ºè¯
â”œâ”€â”€ ğŸ“– æ–‡æ¡£
â”‚   â”œâ”€â”€ README.md                     # é¡¹ç›®è¯´æ˜
â”‚   â”œâ”€â”€ NL2DBæµç¨‹.md                   # ç³»ç»Ÿæµç¨‹è¯´æ˜
â”‚   â”œâ”€â”€ DATABASE_HANDLING.md          # æ•°æ®åº“å¤„ç†è¯´æ˜
â”‚   â””â”€â”€ COLUMN_MAPPING_README.md      # åˆ—åæ˜ å°„è¯´æ˜
â”œâ”€â”€ ğŸ§ª æµ‹è¯•è°ƒè¯•
â”‚   â””â”€â”€ debug/                        # è°ƒè¯•è„šæœ¬ç›®å½•
â”‚       â”œâ”€â”€ test_mcp_client.py        # MCPå®¢æˆ·ç«¯æµ‹è¯•
â”‚       â”œâ”€â”€ fix_database_issue.py     # ä¿®å¤æ•°æ®åº“é—®é¢˜è„šæœ¬
â”‚       â”œâ”€â”€ reinitialize_database.py  # é‡æ–°åˆå§‹åŒ–æ•°æ®åº“è„šæœ¬
â”‚       â””â”€â”€ generate_column_mappings.py  # åˆ—åæ˜ å°„ç”Ÿæˆå™¨è°ƒè¯•è„šæœ¬
â””â”€â”€ ğŸ–¼ï¸ èµ„æºæ–‡ä»¶
    â””â”€â”€ images/                       # é¡¹ç›®æˆªå›¾
```

---

## ğŸ¨ æŠ€æœ¯æ ˆ

### ğŸ§  AI & æœºå™¨å­¦ä¹ 

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **ğŸ¦œ LangChain** | 0.3.29 | LLMåº”ç”¨æ¡†æ¶ |
| **ğŸ”„ LangGraph** | 0.2.60 | å·¥ä½œæµç¼–æ’ |
| **ğŸ¤— HuggingFace** | Latest | æ¨¡å‹åŠ è½½ |
| **ğŸ” FAISS** | 1.9.0 | å‘é‡æ£€ç´¢ |
| **ğŸ¯ BGE-Reranker** | v2-m3 | ç»“æœé‡æ’åº |
| **ğŸ“Š M3E-Base** | Latest | ä¸­æ–‡å‘é‡åŒ– |

### ğŸŒ æœåŠ¡æ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **âš¡ FastMCP** | 2.8.1 | MCPæœåŠ¡æ¡†æ¶ |
| **ğŸ”Œ MCP** | 1.9.4 | æ¨¡å‹ä¸Šä¸‹æ–‡åè®® |
| **ğŸŒŠ SSE** | - | æœåŠ¡å™¨æ¨é€äº‹ä»¶ |
| **ğŸ”„ AsyncIO** | - | å¼‚æ­¥ç¼–ç¨‹ |

### ğŸ’¾ æ•°æ®å¤„ç†

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **ğŸ¼ Pandas** | 2.2.3 | æ•°æ®å¤„ç† |
| **ğŸ—„ï¸ SQLite** | - | æ•°æ®å­˜å‚¨ |
| **ğŸ“Š OpenPyXL** | 3.1.5 | Excelå¤„ç† |
| **ğŸ“ˆ NumPy** | 2.1.3 | æ•°å€¼è®¡ç®— |

### ğŸ¤– å¤§æ¨¡å‹æ”¯æŒ

| æ¨¡å‹ | æä¾›å•† | ç‰¹ç‚¹ |
|------|--------|------|
| **ğŸ§  GLM-4-Plus** | æ™ºè°±AI | ä¸­æ–‡ä¼˜åŒ–ï¼Œæ¨ç†èƒ½åŠ›å¼º |
| **ğŸ¤– GPT-4** | OpenAI | é€šç”¨èƒ½åŠ›å¼ºï¼Œç”Ÿæ€å®Œå–„ |
| **ğŸ”® Qwen-Turbo** | é˜¿é‡Œäº‘ | é«˜æ€§ä»·æ¯”ï¼Œå“åº”å¿«é€Ÿ |
| **ğŸ’» DeepSeek-v3** | DeepSeek | ä»£ç ç”Ÿæˆä¸“å®¶ï¼Œå¼€æºå‹å¥½ |
| **ğŸ­ Claude-3-7-Sonnet** | Anthropic | å®‰å…¨å¯é ï¼Œæ¨ç†ç²¾å‡† |

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### ğŸ“ˆ ä¼˜åŒ–ç­–ç•¥

#### ğŸ§  æ¨¡å‹ä¼˜åŒ–
- **æ‡’åŠ è½½æœºåˆ¶**: æ¨¡å‹æŒ‰éœ€åŠ è½½ï¼Œé¿å…å¯åŠ¨æ—¶å…¨é‡åˆå§‹åŒ–
- **å•ä¾‹æ¨¡å¼**: ç¡®ä¿æ¯ä¸ªæ¨¡å‹åªåˆå§‹åŒ–ä¸€æ¬¡
- **å†…å­˜ç®¡ç†**: æ™ºèƒ½é‡Šæ”¾æœªä½¿ç”¨çš„æ¨¡å‹èµ„æº

#### ğŸ’¾ ç¼“å­˜ä¼˜åŒ–
- **å¤šå±‚ç¼“å­˜**: æ–‡ä»¶ç¼“å­˜ + å†…å­˜LRUç¼“å­˜
- **æ™ºèƒ½å¤±æ•ˆ**: åŸºäºæ–‡ä»¶å“ˆå¸Œçš„ç¼“å­˜éªŒè¯
- **é¢„çƒ­æœºåˆ¶**: å¯åŠ¨æ—¶é¢„åŠ è½½å…³é”®æ¨¡å‹

#### âš¡ å¹¶å‘ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†**: å¤šè¡¨å¤´å¹¶å‘è¯†åˆ«å¤„ç†
- **ä¿¡å·é‡æ§åˆ¶**: åˆç†æ§åˆ¶å¹¶å‘æ•°é‡
- **æµæ°´çº¿å¤„ç†**: é‡å I/Oå’Œè®¡ç®—æ“ä½œ

### ğŸ“Š æ€§èƒ½åŸºå‡†

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| ğŸš€ **å†·å¯åŠ¨** | 32ç§’ | 8-12ç§’ | **75%** |
| âš¡ **é¦–æ¬¡æŸ¥è¯¢** | 35-45ç§’ | 12-18ç§’ | **70%** |
| ğŸ”„ **ç¼“å­˜å‘½ä¸­** | 30-40ç§’ | 1-5ç§’ | **90%** |
| ğŸ’¾ **å†…å­˜å ç”¨** | 2.5GB | 1.2GB | **52%** |
| ğŸ”€ **å¹¶å‘åå** | 1 req/s | 3 req/s | **200%** |

---

## ğŸ›¡ï¸ æ•°æ®å®‰å…¨

### ğŸ”’ éšç§ä¿æŠ¤

- **ğŸ“ æœ¬åœ°å¤„ç†**: æ‰€æœ‰æ•°æ®åœ¨æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ äº‘ç«¯
- **ğŸ”‘ å¯†é’¥å®‰å…¨**: APIå¯†é’¥é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
- **ğŸš« Gitå¿½ç•¥**: æ•æ„Ÿæ–‡ä»¶è‡ªåŠ¨æ’é™¤ç‰ˆæœ¬æ§åˆ¶
- **ğŸ›¡ï¸ è®¿é—®æ§åˆ¶**: æ”¯æŒæœ¬åœ°ç½‘ç»œè®¿é—®é™åˆ¶

### ğŸ“‹ å¿½ç•¥æ–‡ä»¶åˆ—è¡¨

```gitignore
# ğŸ”’ æ•æ„Ÿé…ç½®
.env
file_registry.json

# ğŸ“ ç”¨æˆ·æ•°æ®
uploads/
database.db
*.db

# ğŸ§  AIæ¨¡å‹ç¼“å­˜
Faiss/
column_mapping_docs/
cache/

# ğŸ Pythonç¯å¢ƒ
__pycache__/
venv/
*.pyc
```

---

## ğŸ”§ å¼€å‘æŒ‡å—

### ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

1. **ğŸ”„ å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶ä¸“æ³¨ç‰¹å®šåŠŸèƒ½
2. **ğŸ”Œ æ¾è€¦åˆ**: ç»„ä»¶é—´é€šè¿‡æ¥å£äº¤äº’
3. **ğŸ“ˆ å¯æ‰©å±•**: æ”¯æŒæ–°æ¨¡å‹å’Œæ•°æ®æº
4. **ğŸ›¡ï¸ å®¹é”™æ€§**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
5. **âš¡ é«˜æ€§èƒ½**: å¤šå±‚ä¼˜åŒ–ç­–ç•¥

### ğŸ†• æ·»åŠ æ–°æ¨¡å‹æ”¯æŒ

```python
# åœ¨NL2DB.pyçš„ ModelManager._create_llm() ä¸­æ·»åŠ 
elif provider == "your_provider":
    from your_langchain_provider import YourChatModel
    return YourChatModel(
        api_key=os.getenv("YOUR_API_KEY"),
        model=config.get("model_name", "your-model"),
        temperature=config.get("temperature", 0.2)
    )
```

### ğŸ§ª æµ‹è¯•æ¡†æ¶

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/

# è¿è¡Œé›†æˆæµ‹è¯•
python debug/test_mcp_client.py --full

# æ€§èƒ½åŸºå‡†æµ‹è¯•
python debug/benchmark.py
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### ğŸ¯ è´¡çŒ®æ–¹å¼

1. **ğŸ› æŠ¥å‘ŠBug**: é€šè¿‡IssuesæŠ¥å‘Šé—®é¢˜
2. **ğŸ’¡ åŠŸèƒ½å»ºè®®**: æå‡ºæ–°åŠŸèƒ½æƒ³æ³•
3. **ğŸ“ æ–‡æ¡£æ”¹è¿›**: å®Œå–„é¡¹ç›®æ–‡æ¡£
4. **ğŸ”§ ä»£ç è´¡çŒ®**: æäº¤Pull Request

### ğŸ“‹ å¼€å‘æµç¨‹

```bash
# 1. Forké¡¹ç›®
git fork https://github.com/your-username/NL2DB.git

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/your-feature

# 3. æäº¤æ›´æ”¹
git commit -m "feat: add your feature"

# 4. æ¨é€åˆ†æ”¯
git push origin feature/your-feature

# 5. åˆ›å»ºPull Request
```

### ğŸ“ ä»£ç è§„èŒƒ

- **ğŸ Python**: éµå¾ªPEP 8è§„èŒƒ
- **ğŸ“– æ³¨é‡Š**: ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š
- **ğŸ§ª æµ‹è¯•**: æ–°åŠŸèƒ½éœ€è¦å•å…ƒæµ‹è¯•
- **ğŸ“š æ–‡æ¡£**: æ›´æ–°ç›¸å…³æ–‡æ¡£

---

## ğŸ‰ è‡´è°¢

### ğŸ™ å¼€æºé¡¹ç›®

- **ğŸ¦œ LangChain**: å¼ºå¤§çš„LLMåº”ç”¨æ¡†æ¶
- **âš¡ FastMCP**: é«˜æ•ˆçš„MCPæœåŠ¡æ¡†æ¶
- **ğŸ” FAISS**: Facebookçš„å‘é‡æ£€ç´¢åº“
- **ğŸ¤— HuggingFace**: ä¸°å¯Œçš„æ¨¡å‹ç”Ÿæ€
- **ğŸ¼ Pandas**: æ•°æ®å¤„ç†çš„ç‘å£«å†›åˆ€

### ğŸŒŸ ç‰¹åˆ«æ„Ÿè°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºå¼€æºç¤¾åŒºåšå‡ºè´¡çŒ®çš„å¼€å‘è€…ä»¬ï¼

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

---

<div align="center">

### ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªStarï¼ ğŸŒŸ

[![GitHub Stars](https://img.shields.io/github/stars/Yudewei1112/NL2DB?style=social&label=Star)](https://github.com/Yudewei1112/NL2DB)
[![GitHub Forks](https://img.shields.io/github/forks/Yudewei1112/NL2DB?style=social&label=Fork)](https://github.com/Yudewei1112/NL2DB)
[![GitHub Watchers](https://img.shields.io/github/watchers/Yudewei1112/NL2DB?style=social&label=Watch)](https://github.com/Yudewei1112/NL2DB)

**è®©å¤æ‚EXCELæ–‡æ¡£æ•°æ®æŸ¥è¯¢å˜å¾—åƒèŠå¤©ä¸€æ ·ç®€å•ï¼**

[ğŸ  é¦–é¡µ](https://github.com/Yudewei1112/NL2DB) â€¢ [ğŸ“– æ–‡æ¡£](https://github.com/Yudewei1112/NL2DB/wiki) â€¢ [ğŸ› é—®é¢˜åé¦ˆ](https://github.com/Yudewei1112/NL2DB/issues) â€¢ [ğŸ’¬ ç¤¾åŒºè®¨è®º](https://github.com/Yudewei1112/NL2DB/discussions)

</div>

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **ğŸ“š é¡¹ç›®æ–‡æ¡£**: [Wiki](https://github.com/Yudewei1112/NL2DB/wiki)
- **ğŸ’¬ ç¤¾åŒºè®¨è®º**: [Discussions](https://github.com/Yudewei1112/NL2DB/discussions)
- **ğŸ“§ è”ç³»æˆ‘ä»¬**: [Email](mailto:yudewei1112@gmail.com)

---

<div align="center">

**ğŸš€ NL2DB - è®©AIä¸ºä½ çš„æ•°æ®èµ‹èƒ½ï¼ ğŸš€**

*Built with â¤ï¸ by the Yu Dewei*

</div>